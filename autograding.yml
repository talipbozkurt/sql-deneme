name: Autograding

on: [push]

permissions:
  contents: read
  checks: write

jobs:
  grade:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout student repo
        uses: actions/checkout@v4

      # ğŸ” DEBUG
      - name: Debug workspace
        run: |
          echo "PWD:"
          pwd
          echo "FILES:"
          ls -la

      # ğŸ”’ FETCH HIDDEN TESTS
      - name: Fetch hidden tests
        run: |
          # Download __init__.py to the checking directory (current directory)
          python -c "import urllib.request; urllib.request.urlretrieve('https://gist.github.com/Yildirim-AliD/e919ea04e34f807f47eba0ba052d033e', '__init__.py')"

      # ğŸ“¦ INSTALL DEPENDENCIES
      - name: Install dependencies
        run: |
          pip install cs50 sqlparse

      # ğŸ§ª RUN AUTOGRADER
      - name: Run autograder
        run: |
          # 1. Run the script in the current directory (.)
          # 2. lab50.py is assumed to be in the root based on your repo structure
          python3 lab50.py .
